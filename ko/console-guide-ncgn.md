## Storage > Backup > 콘솔 사용 가이드

## 백업 에이전트(agent)
백업할 서버를 등록하려면 먼저 대상 서버에 에이전트(agent)를 설치해야 합니다. 에이전트를 설치할 때는 사용자의 도메인 정보가 필요합니다. 도메인 정보는 **서버 등록** 페이지에서 확인할 수 있습니다.

* 사용자 도메인
```
/NGSCBackup/{domain-id}
```

> [참고]  
> 도메인은 많은 수의 서버를 그룹화하여 관리하기 위해 사용하는 백업 시스템의 단위입니다.
> 도메인은 백업 서비스를 활성화하면 자동으로 생성됩니다.
> 사용자의 도메인에 백업할 서버를 등록하려면 에이전트 설치 명령의 파라미터로 도메인 정보를 입력합니다.
>

<br/>

### 서버 보안 그룹(security group) 설정

백업 서버와 통신하려면 서버 보안 그룹에 아래 내용을 추가합니다.

| 방향(direction) | 포트 | CIDR                              |
| --- | --- |-----------------------------------|
| Ingress/Egress | ALL TCP | 172.16.31.4/32<br/>172.16.31.5/32 |


<br/>

### 백업 CLI 설치

* **Linux**

```
curl http://169.254.169.251:8080/download/backup/scripts/bootstrap.sh | bash
```

<br/>

### 백업 에이전트 설치

> [주의]
> 백업은 에이전트가 설치된 서버의 호스트 이름으로 서버를 등록합니다.
> 하나의 사용자 도메인 내에 같은 호스트 이름으로 여러 서버를 등록한다면 백업이 수행되지 않을 수 있습니다.
> 에이전트를 설치하기 전, 호스트 이름이 중복되지 않는지 확인하세요.

다음과 같이 에이전트를 설치합니다.

* **Linux**

```
tcbackup install {user-domain}
```

<br/>

* **Windows**

Windows용 에이전트는 [NHN Cloud 다운로드 페이지](https://docs.gncloud.go.kr/ko/Download)에서 다운로드해 설치합니다. 설치 중 MC Server와 MC Domain 정보를 입력해야 합니다. MC Domain은 사용자의 도메인 정보입니다. MC Server에는 다음 정보를 입력합니다.

```
MC Server : 172.16.31.4
```

<br/>

### 백업 에이전트 재등록
백업할 서버의 호스트명이 변경되었다면 에이전트를 다시 등록해야 합니다. 재등록 명령은 다음과 같습니다.

* **Linux**

```
tcbackup re-register
```

<br/>

* **Windows**

아래 PowerShell 스크립트를 다운로드해 실행합니다.

[re-register.ps1](https://static.toastoven.net/toastcloud/sdk_download/backup/scripts/windows/re-register.ps1)

<br/>

### 백업 에이전트 종료
잠시 백업을 중단하고 싶다면 에이전트를 종료할 수 있습니다.

* **Linux**

```
tcbackup stop
```

<br/>

* **Windows**

시스템 트레이에서 백업 에이전트 아이콘을 마우스 오른쪽 버튼으로 클릭한 다음 **종료**를 클릭합니다.

<br/>

### 백업 에이전트 재시작
종료한 백업 에이전트를 다시 시작하려면 다음 명령을 사용합니다.

* **Linux**

```
tcbackup restart
```

<br/>

* **Windows**

시작 메뉴에서 **EMC Avamar > Client**를 실행합니다.

<br/>

## 서버 등록
백업할 서버에 에이전트를 설치하면 **서버 등록** 화면의 **서버 선택** 항목에서 에이전트가 등록된 서버의 호스트 이름을 선택할 수 있습니다. 이미 등록한 서버는 선택 목록에서 제외됩니다.

### 백업 계획 추가
하나의 서버에 여러 개의 백업 계획을 추가할 수 있습니다. 백업 계획 추가는 서버 등록이 완료된 다음에도 할 수 있습니다.

> [주의]
> 백업은 서버에 부하를 주지 않기 위해 백그라운드에서 천천히 진행됩니다.
> **500GB 이상의 대용량 데이터** 또는 **3백만 개를 초과하는 다량의 파일**을 백업할 때는 최대 수행 시간인 3시간을 초과해 백업이 실패할 수 있습니다.
> 백업하려는 경로의 데이터가 기준량을 초과한다면 경로를 나누어 순차적으로 백업할 수 있도록 설정하는 것을 권장합니다.
> 다량의 파일이 존재하는 디렉터리의 경우 파일을 압축하여 백업하는 것을 권장합니다.
> NAS(offline) 서비스의 데이터 또는 매우 큰 용량의 데이터를 백업하려면 고객 센터로 문의하세요.

* **백업 경로**

백업할 경로를 지정합니다. 절대 경로를 정확히 입력해야 합니다. 경로를 잘못 입력하면 백업이 되지 않거나 원치 않는 경로가 백업될 수 있습니다. Soft link를 백업 경로로 설정하면, soft link file만 백업됩니다.

```
예시)
Windows :   c:\backup
Linux   :   /home/backup
```

<br/>

* **백업 주기**

백업을 수행할 주기입니다. 1일 간격, 7일 간격 중 선택할 수 있습니다.

<br/>

* **백업 시각**

백업을 시작할 시각입니다. 1시간 단위로 선택할 수 있습니다. 파일 변경이 가장 적고, 서버가 유휴 상태인 시각을 권장합니다. 실제 백업 시작은 상황에 따라 최대 1시간 정도 차이가 날 수 있습니다.

<br/>

* **백업 보관 주기**

백업된 복제본을 보관할 기간입니다. 7일, 14일, 21일, 30일, 6개월(180일), 1년(365일), 3년(1095일), 5년(1825일) 중 선택할 수 있습니다.

<br/>

### 백업 계획 목록
서버 목록에서 서버 이름 왼쪽의 체크박스를 선택하면 화면 하단의 상세 화면에 선택한 서버의 백업 계획 목록이 표시됩니다.

<br/>

### 백업 결과 조회
백업 계획 목록에서 백업 경로를 클릭하면 백업 결과를 조회할 수 있습니다. 백업 결과는 백업 완료 시각으로부터 최대 1시간 이내에 집계됩니다.

| 백업 결과 | 의미 |
| --- | --- |
| 성공 | 백업 성공 |
| 성공(주의) | 백업을 완료했지만, 백업 도중 원본 파일이 변경됨 |
| 실패 | 백업 실패 |

> [참고]
> 네트워크 상태와 백업 데이터의 용량, 같은 시간에 시작하도록 설정된 많은 백업 일정 등에 의해 3시간 이내에 백업이 완료되지 않으면 해당 일정은 실패로 기록됩니다.
> 지속적으로 업데이트하는 디렉터리의 백업 계획은 실패할 수 있습니다.

<br/>

### 백업 정책 변경
백업 계획 목록에서 각 항목 오른쪽에 있는 **변경** 버튼을 클릭하면 백업 정책을 변경할 수 있습니다. 변경할 수 있는 항목은 `백업 주기`, `백업 시각`, `보관 주기`입니다.

<<br/>

## 복원
등록한 백업 계획이 1회 이상 수행되었다면 백업 결과가 생성되고, 생성된 백업 결과 중 하나를 선택하여 복원을 진행할 수 있습니다.

<br/>

* **백업 경로**

백업 결과의 백업 경로를 선택하거나 일부 경로를 선택할 수 있습니다.

<br/>

* **복원 대상 서버**

백업 에이전트가 설치된 서버중 선택할 수 있습니다.
복원 원본 서버와 동일한 운영체제 계열(Linux 또는 Windows)의 서버를 선택해야 합니다.

<br/>

* **저장 경로**

저장 경로는 원하는 경로로 지정할 수 있으며 입력한 경로가 존재하지 않을 경우 자동으로 경로를 생성하여 복원이 진행됩니다.
입력한 경로에 복원 데이터가 덮어쓰기 방식으로 저장됩니다.

<br/>

## 서버 등록 해제
서버 등록을 해제하기 전에 반드시 등록한 백업 계획을 삭제해야 합니다. 백업 계획이 남아 있다면 안내 메시지가 나타나고 해제가 중단됩니다.

> [주의]
> 서버 등록을 해제하면 보관된 백업 데이터도 삭제됩니다. 백업 데이터가 필요하다면 미리 복구 요청을 해서 원하는 서버에 복구해야 합니다.
>

서버 등록을 해제한 후에는 반드시 서버에 접속해서 에이전트를 정지시키고 에이전트 등록을 해지해야 합니다. 그렇지 않으면 해당 서버를 다시 등록할 수 없습니다. 해지 명령은 다음과 같습니다.

<br/>

* **Linux**

```
tcbackup uninstall
```

<br/>

* **Windows**

에이전트를 종료합니다. 다음에 다시 사용할 때는 클라이언트 활성화 항목을 열어 새로운 도메인 정보를 입력합니다.
