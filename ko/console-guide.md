## Storage > Backup > 콘솔 사용 가이드

## 백업 에이전트
백업할 서버를 등록하기 위해서는 먼저 대상 서버에 에이전트를 설치해야 합니다. 에이전트를 설치할 때는 사용자의 도메인 정보가 필요합니다. 도메인 정보는 서버 등록 페이지에서 확인할 수 있습니다.

> [참고]  
> 도메인은 많은 수의 서버를 그룹화하여 관리하기 위해 사용하는 백업 시스템의 단위입니다.
> 도메인은 백업 서비스를 활성화하면 자동으로 생성됩니다.
> 사용자의 도메인에 백업할 서버를 등록하기 위해 에이전트 설치 명령의 파라미터로 도메인 정보를 입력합니다.

<br>
<center>
<img src="http://static.toastoven.net/prod_backup/console_guide/image_01.png"/>
</center>
<br>
<br>

### 서버 Security Group 설정

백업 서버와 통신을 위해 서버 Security Group 에 아래 내용을 추가합니다.

| Direction        | 포트      | CIDR               |
| ---------------- | ------- | ------------------ |
| Ingress / Egress | ALL TCP | 133.186.132.0/24   |
| Egress           | 443     | 103.243.202.188/32 |



### 백업 CLI 설치

* **Linux**

   ```
   # curl http://static.toastoven.net/toastcloud/sdk_download/backup/scripts/bootstrap.sh | bash
   ```



### 백업 에이전트 설치

도메인 정보가 `/TCBackup_alpha/faL6GUt2nboWNI0a`라면 다음과 같이 에이전트를 설치합니다.

* **Linux**

    ```
    # tcbackup install /TCBackup_alpha/faL6GUt2nboWNI0a
    ```

* **Windows**

  Windows 용 에이전트는 [TOAST의 다운로드 페이지](http://docs.cloud.toast.com/ko/Download)에서 다운로드해 설치합니다. 설치 중 MC Server와 MC Domain 정보를 입력해야 합니다. MC Domain은 사용자의 도메인 정보입니다. MC Server는 다음 정보를 입력해 주십시오.

    ```
    MC Server : tcbackup1.toastmaker.net
    ```

<br>
<center>
<img src="http://static.toastoven.net/prod_backup/console_guide/image_02.png"/>
<br>
</center>
<br>
<br>

### 백업 에이전트 재등록
백업할 서버의 호스트명이 변경되었다면 에이전트를 재등록해야 합니다. 재등록 명령은 다음과 같습니다.

* **Linux**

    ```
    # tcbackup re-register
    ```

* **Windows** 

  아래 powershell script 를 다운로드 받아 실행합니다.

   ```
   http://static.toastoven.net/toastcloud/sdk_download/backup/scripts/windows/re-register.ps1
   ```


### 백업 에이전트 종료
잠시 백업을 중단하고 싶다면 에이전트를 종료할 수 있습니다.

* **Linux**

    ```
    # tcbackup stop
    ```

* **Windows**
    * 시스템 트레이에서 백업 에이전트 아이콘을 우클릭한 다음 종료 항목을 클릭합니다.

### 백업 에이전트 재시작
종료한 백업 에이전트를 다시 시작하려면 다음 명령을 사용합니다.

* **Linux**

    ```
    # tcbackup restart
    ```

* **Windows**
    * 시작 메뉴에서 EMC Avamar > Client를 실행합니다.


## 서버 등록
백업할 서버에 에이전트를 설치하면 서버 등록 화면의 서버 선택 항목에서 에이전트가 등록된 서버를 선택할 수 있습니다.

### 백업 경로 추가
하나의 서버에 여러 개의 백업 경로를 추가할 수 있습니다. 백업 경로 추가는 서버 등록이 완료된 다음에도 가능합니다.

* **백업 경로**

  백업할 경로를 지정합니다. 절대 경로를 정확히 입력해야 합니다. 경로를 잘못 입력하면 백업이 되지 않거나 원치 않는 경로가 백업될 수 있습니다.

    ```
    예시)
    Windows :   c:\backup
    Linux   :   /home/backup
    ```

* **백업 주기**

  백업을 수행할 주기입니다. 1일 간격, 7일 간격 중 선택할 수 있습니다.

* **백업 시각**

  백업을 시작할 시각입니다. 1시간 단위로 선택할 수 있습니다. 파일 변경이 가장 적고, 서버가 유휴 상태인 시각을 권장합니다.

* **보관 주기**

  백업된 복제본을 보관할 기간입니다. 7일, 14일, 21일, 30일 중 선택할 수 있습니다.


### 백업 경로 목록
서버 목록에서 서버 이름 왼쪽의 체크박스를 선택하면 화면 하단의 상세 화면에 선택한 서버의 백업 경로 목록이 표시됩니다.

### 백업 결과 조회
백업 경로 목록에서 백업 경로를 클릭하면 백업 결과를 조회할 수 있습니다. 백업 결과는 백업 완료 시각으로부터 최대 30분 이내에 집계됩니다.

| 백업 결과  | 의미                          |
| ------ | --------------------------- |
| 성공     | 백업 성공                       |
| 성공(주의) | 백업을 완료했지만, 백업 도중 원본 파일이 변경됨 |
| 실패     | 백업 실패                       |

> [참고]
> 네트워크 상태와 백업 데이터의 용량, 같은 시간에 시작하도록 설정된 많은 백업 일정 등에 의해 3시간 이내에 백업이 완료되지 않으면 해당 일정은 실패로 기록됩니다.

### 백업 정책 변경

백업 경로 목록에서 각 항목 오른쪽에 있는 `[변경]` 버튼을 클릭하면 백업 정책을 변경할 수 있습니다. 변경할 수 있는 항목은 `백업 주기`, `백업 시각`, `보관 주기`입니다.

## 복구 신청
등록한 백업 경로가 1회 이상 백업되었다면, 해당 데이터로 복구를 신청할 수 있습니다.

* **백업 경로**

  사용자가 추가했던 백업 경로 중 하나를 선택할 수 있습니다.

* **백업 일자**

  복구할 복제본이 백업된 날짜를 선택할 수 있습니다. 한 번도 백업되지 않았거나, 모두 실패하여 복구할 수 있는 백업 데이터가 없다면 복구할 데이터가 없다는 메시지가 표시됩니다.

* **요청 사항**

  복구에 필요한 세부 사항을 자유롭게 요청할 수 있습니다. 백업한 서버에 그대로 복구할 수 있지만 새로운 서버에 복구할 수도 있습니다.

  ```
    예시)
  복구할 서버의 호스트명   : backup.guide
  복구할 경로 : /home/debian
  ```

* **연락처**

  원활한 복구를 위해 담당자와 요청자 사이의 대화 채널로 사용할 연락처를 입력합니다. 수집된 개인정보는 저장하지 않으며 복구를 완료하면 즉각 폐기합니다.

복구 진행 상태는 다음 표와 같이 표시됩니다.

| 상태   | 의미           |
| ---- | ------------ |
| 접수   | 복구 요청이 접수됨   |
| 진행 중 | 운영자가 복구를 시작함 |
| 완료   | 복구 완료        |


## 서버 삭제

서버를 삭제하기 전에 반드시 등록한 백업 경로를 삭제해야 합니다. 등록된 백업 경로가 있다면 안내 메시지가 나타나고 삭제가 중단됩니다.

> [주의]
> 서버를 삭제하면 보관된 백업 데이터도 삭제됩니다. 백업 데이터가 필요하다면 미리 복구 요청을 통해 원하는 서버에 복구해야 합니다.

웹 콘솔에서 서버를 삭제한 후에는 반드시 서버에서 에이전트를 정지시키고 등록을 해지해야 합니다. 그렇지 않으면 해당 서버를 다시 등록할 수 없습니다. 해지 명령은 다음과 같습니다.

* **Linux**

    ```
    # tcbackup uninstall
    ```

* **Windows**

    에이전트를 종료합니다. 다음에 다시 사용할 때는 클라이언트 활성화 항목을 열어 새로운 도메인 정보를 입력합니다.
